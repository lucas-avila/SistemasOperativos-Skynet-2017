/*
 * FuncionesMemoria.c
 *
 *  Created on: 6/4/2017
 *      Author: utnso
 */
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include "header/FuncionesMemoria.h"
#include<commons/collections/list.h>
void inicializar_programa(char* PID, int cantidad_paginas_requeridas) {

}

char* solicitar_bytes_de_una_pagina(char* PID, int pagina, int byteInicial, int longitud) {
	return string_substring(MEMORIA_PRINCIPAL, configuraciones.MARCO_SIZE * pagina + byteInicial, longitud);

}

void almacenar_bytes_de_una_pagina(char* PID, int pagina, int byteInicial, int longitud, char*contenido) {

	char* primeraParte = string_substring(MEMORIA_PRINCIPAL, pagina * configuraciones.MARCO_SIZE + byteInicial, longitud);
	printf("\n%d", strlen(primeraParte));

	char* textoMedio = contenido;
	char* segundaParte = string_substring_from(MEMORIA_PRINCIPAL, pagina * configuraciones.MARCO_SIZE + byteInicial + longitud);
	printf("\n%d", strlen(segundaParte));
	string_capitalized(MEMORIA_PRINCIPAL);

	MEMORIA_PRINCIPAL = string_new();

	string_append(&MEMORIA_PRINCIPAL, primeraParte);
	string_append(&MEMORIA_PRINCIPAL, textoMedio);
	string_append(&MEMORIA_PRINCIPAL, segundaParte);

	string_capitalized(primeraParte);
	string_capitalized(segundaParte);
	printf("\n%s", MEMORIA_PRINCIPAL);

}

char* asignar_paginas_a_proceso(char *PID, int cantidad_paginas_requeridas) {
	int cantidad_paginas_pedidas = 0;

	while (cantidad_paginas_pedidas < cantidad_paginas_requeridas) {
		Tabla_Pagina_Invertida registro = buscar_pagina_disponible();
		if (registro == NULL) {
			return "FALTA ESPACIO";
		}
		strcpy(registro.PID, PID);
		actualizar_tabla_pagina(registro);
		cantidad_paginas_pedidas++;
	}
	return "OK";

}

void finalizar_programa(char *PID) {
	int i = 0;
	for (i = 0; i < list_size(tablaPaginasInvertidas); i++) {
		Tabla_Pagina_Invertida registro = list_get(tablaPaginasInvertidas,0);
		if(strcmp(registro.PID,PID)==0){
			strcpy(registro.PID,"-1");
		}
	}
}

